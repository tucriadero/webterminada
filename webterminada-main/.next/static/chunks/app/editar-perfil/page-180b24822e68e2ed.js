(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[330],{4355:function(e,a,r){Promise.resolve().then(r.bind(r,7745))},7745:function(e,a,r){"use strict";r.r(a),r.d(a,{default:function(){return d}});var t=r(7437),o=r(2265),s=r(1774),l=r(9376),n=r(2141),i=r(9064),u=r(7648);let c=["\xc1lava","Albacete","Alicante","Almer\xeda","Asturias","\xc1vila","Badajoz","Barcelona","Burgos","C\xe1ceres","C\xe1diz","Cantabria","Castell\xf3n","Ciudad Real","C\xf3rdoba","Cuenca","Gerona","Granada","Guadalajara","Guip\xfazcoa","Huelva","Huesca","Islas Baleares","Ja\xe9n","La Coru\xf1a","La Rioja","Las Palmas","Le\xf3n","L\xe9rida","Lugo","Madrid","M\xe1laga","Murcia","Navarra","Orense","Palencia","Pontevedra","Salamanca","Santa Cruz de Tenerife","Segovia","Sevilla","Soria","Tarragona","Teruel","Toledo","Valencia","Valladolid","Vizcaya","Zamora","Zaragoza"];function d(){let e=(0,s.useUser)(),a=(0,l.useRouter)(),[r,d]=(0,o.useState)(""),[p,f]=(0,o.useState)(""),[v,h]=(0,o.useState)(""),[m,b]=(0,o.useState)(""),[x,g]=(0,o.useState)(""),[S,C]=(0,o.useState)(""),[j,w]=(0,o.useState)(!1),[N,y]=(0,o.useState)(null),[E,P]=(0,o.useState)(null),[I,O]=(0,o.useState)(null),[_,z]=(0,o.useState)(!1);(0,o.useEffect)(()=>{e&&(async()=>{let{data:a,error:r}=await n.O.from("profiles").select("*").eq("id",e.id).single();if(r||!a){i.ZP.error("Error al cargar perfil");return}d(a.username||""),f(a.nombre||""),h(a.telefono||""),b(a.provincia||""),g(a.afijo||""),C(a.nucleo_zoologico||""),w(a.is_criadero||!1),a.avatar_url&&(P(a.avatar_url),O("https://cinsudwupbiqqizvqwij.supabase.co/storage/v1/object/public/avatars/".concat(a.avatar_url)))})()},[e]);let L=async t=>{if(t.preventDefault(),e){z(!0);try{let t=E;if(N){let a=N.name.split(".").pop(),r="".concat(e.id,"/").concat(Date.now(),".").concat(a),{error:o}=await n.O.storage.from("avatars").upload(r,N,{upsert:!0});if(o){console.error(o),i.ZP.error("No se pudo subir el avatar");return}t=r}let{error:o}=await n.O.from("profiles").update({username:r,nombre:p,telefono:v,provincia:m,afijo:j?x:null,nucleo_zoologico:j?S:null,is_criadero:j,avatar_url:t||null}).eq("id",e.id);if(o){i.ZP.error("No se pudieron guardar los cambios");return}i.ZP.success("Perfil actualizado"),a.push("/mi-perfil")}catch(e){console.error(e),i.ZP.error("Error inesperado")}finally{z(!1)}}};return(0,t.jsxs)("div",{className:"min-h-screen bg-[#DFF6EA] flex flex-col items-center justify-center px-4 py-10",children:[(0,t.jsx)("img",{src:"/logo-criador.png",alt:"Logo",className:"w-20 h-20 mb-6"}),(0,t.jsxs)("form",{onSubmit:L,className:"bg-white w-full max-w-md p-6 rounded-3xl shadow-xl space-y-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-center text-[#5cae97]",children:"Editar perfil"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];r&&(y(r),O(URL.createObjectURL(r)))}}),I&&(0,t.jsx)("img",{src:I,alt:"Vista previa",className:"w-[100px] h-[100px] rounded-full border object-cover mx-auto"}),(0,t.jsx)("input",{value:r,onChange:e=>d(e.target.value),placeholder:"Usuario",className:"w-full border px-4 py-2 rounded-lg"}),(0,t.jsx)("input",{value:p,onChange:e=>f(e.target.value),placeholder:"Nombre",className:"w-full border px-4 py-2 rounded-lg"}),(0,t.jsx)("input",{value:v,onChange:e=>h(e.target.value),placeholder:"Tel\xe9fono",className:"w-full border px-4 py-2 rounded-lg"}),(0,t.jsxs)("select",{value:m,onChange:e=>b(e.target.value),className:"w-full border px-4 py-2 rounded-lg",children:[(0,t.jsx)("option",{value:"",children:"Selecciona tu provincia"}),c.map(e=>(0,t.jsx)("option",{value:e,children:e},e))]}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:j,onChange:e=>w(e.target.checked)}),"Soy criadero"]}),j&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{value:x,onChange:e=>g(e.target.value),placeholder:"Afijo",className:"w-full border px-4 py-2 rounded-lg"}),(0,t.jsx)("input",{value:S,onChange:e=>C(e.target.value),placeholder:"N\xfacleo zool\xf3gico",className:"w-full border px-4 py-2 rounded-lg"})]}),(0,t.jsx)("button",{type:"submit",disabled:_,className:"w-full bg-[#5cae97] text-white font-semibold py-2 rounded-lg",children:_?"Guardando...":"Guardar cambios"})]}),(0,t.jsx)(u.default,{href:"/inicio",className:"mt-6 inline-block text-[#5cae97] hover:underline",children:"← Volver al inicio"})]})}},2141:function(e,a,r){"use strict";r.d(a,{O:function(){return t}});let t=(0,r(6580).eI)("https://cinsudwupbiqqizvqwij.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpbnN1ZHd1cGJpcXFpenZxd2lqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI0ODQ3MTIsImV4cCI6MjA2ODA2MDcxMn0.NL4RoZ3dPWllHaJfK37WtPtu-6NTNJ-DRJrs6MAY8E0")},1774:function(e,a,r){"use strict";var t=Object.defineProperty,o=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,l=Object.prototype.hasOwnProperty,n=(e,a,r)=>new Promise((t,o)=>{var s=e=>{try{n(r.next(e))}catch(e){o(e)}},l=e=>{try{n(r.throw(e))}catch(e){o(e)}},n=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,l);n((r=r.apply(e,a)).next())}),i={};((e,a)=>{for(var r in a)t(e,r,{get:a[r],enumerable:!0})})(i,{SessionContextProvider:()=>p,useSession:()=>h,useSessionContext:()=>f,useSupabaseClient:()=>v,useUser:()=>m}),e.exports=((e,a,r,n)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let r of s(a))l.call(e,r)||void 0===r||t(e,r,{get:()=>a[r],enumerable:!(n=o(a,r))||n.enumerable});return e})(t({},"__esModule",{value:!0}),i);var u=r(2265),c=r(7437),d=(0,u.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),p=({supabaseClient:e,initialSession:a=null,children:r})=>{let[t,o]=(0,u.useState)(a),[s,l]=(0,u.useState)(!a),[i,p]=(0,u.useState)();(0,u.useEffect)(()=>{!t&&a&&o(a)},[t,a]),(0,u.useEffect)(()=>{let a=!0;return function(){n(this,null,function*(){let{data:{session:r},error:t}=yield e.auth.getSession();if(a){if(t){p(t),l(!1);return}o(r),l(!1)}})}(),()=>{a=!1}},[]),(0,u.useEffect)(()=>{let{data:{subscription:a}}=e.auth.onAuthStateChange((e,a)=>{a&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e||"USER_UPDATED"===e)&&o(a),"SIGNED_OUT"===e&&o(null)});return()=>{a.unsubscribe()}},[]);let f=(0,u.useMemo)(()=>s?{isLoading:!0,session:null,error:null,supabaseClient:e}:i?{isLoading:!1,session:null,error:i,supabaseClient:e}:{isLoading:!1,session:t,error:null,supabaseClient:e},[s,t,i]);return(0,c.jsx)(d.Provider,{value:f,children:r})},f=()=>{let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSessionContext must be used within a SessionContextProvider.");return e};function v(){let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var h=()=>{let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSession must be used within a SessionContextProvider.");return e.session},m=()=>{var e,a;let r=(0,u.useContext)(d);if(void 0===r)throw Error("useUser must be used within a SessionContextProvider.");return null!=(a=null==(e=r.session)?void 0:e.user)?a:null}}},function(e){e.O(0,[648,580,859,971,117,744],function(){return e(e.s=4355)}),_N_E=e.O()}]);